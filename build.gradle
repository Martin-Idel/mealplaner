buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "com.github.spotbugs:spotbugs-gradle-plugin:3.0.0"
    }
}

apply plugin: "java"

// apply plugin: "findbugs"

allprojects {
    repositories {
        jcenter()
        mavenCentral()
    }
}

subprojects {
    version = '1.0'
}

dependencies {
    compile "org.slf4j:slf4j-api:1.7.22"
    compile "org.swinglabs.swingx:swingx-all:1.6.5-1"
    compile group: "org.apache.logging.log4j", name: "log4j-slf4j-impl", version: "2.9.1"
    compile group: "org.apache.logging.log4j", name: "log4j-api", version: "2.9.1"
    compile group: "org.apache.logging.log4j", name: "log4j-core", version: "2.9.1"
    annotationProcessor group: "org.apache.logging.log4j", name: "log4j-core", version: "2.9.1"
    compile group: "javax.xml.bind", name: "jaxb-api", version: "2.4.0-b180830.0359"

    runtime "org.glassfish.jaxb:jaxb-runtime:2.4.0-b180830.0438"
    runtime "org.swinglabs.swingx:swingx-all:1.6.5-1"

    testImplementation "org.assertj:assertj-swing-junit:3.8.0"
    testImplementation "org.assertj:assertj-core:3.8.0"
    testImplementation "junit:junit:4.12"
    testImplementation "org.mockito:mockito-core:1.10.19"
}

task copyLicenses(type: Copy) {
	into "build/libs/licenses/"
	from "licenses/"
}

subprojects {
    apply plugin: 'checkstyle'
    checkstyle {
        toolVersion = "8.5"
        ignoreFailures = false
    }

    tasks.withType(Checkstyle).each { checkstyleTask ->
        checkstyleTask.doLast {
            reports.all { report ->
                def outputFile = report.destination
                if (outputFile.exists() && outputFile.text.contains("<error ")) {
                    throw new GradleException("There were checkstyle warnings! For more info check $outputFile")
                }
            }
        }
    }
}

subprojects {
    apply plugin: 'pmd'
    pmd {
        toolVersion = "5.8.1"
        ignoreFailures = false
        reportsDir = file("$project.buildDir/reports/pmd")
        ruleSets = [
                "java-basic",
                "java-braces",
                "java-clone",
                "java-empty",
                "java-finalizers",
                "java-strictexception",
                "java-sunsecure",
                "java-typeresolution",
                "java-unnecessary",
                "java-unusedcode",
                "java-design",
        ]
    }
}

subprojects {
    apply plugin: 'com.github.spotbugs'
    spotbugs {
        toolVersion = "3.1.12"
        ignoreFailures = false
        effort = "max"
        excludeFilter = file("$rootProject.projectDir/config/spotbugs/excludeFilter.xml")
    }
}
